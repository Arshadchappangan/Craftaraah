<%-include("../../views/partials/user/header")%>

    <!-- Hero Section Begin -->
    <section class="hero hero-normal">
        <div class="container">
            <div class="row">
                <div class="col-lg-3">

                </div>
                <div class="col-lg-9">
                    <div class="hero__search">
                        <div class="hero__search__form">
                            <form action="/search" method="post" id="searchForm" onsubmit="searchSubmit(event)">
                                <div class="hero__search__categories">
                                    All Categories
                                    <span class="arrow_carrot-down"></span>
                                </div>
                                <input type="text" placeholder="What do yo u need?" name="query" id="searchInput">
                                <button type="submit" class="site-btn">SEARCH</button>
                            </form>
                        </div>
                        <div class="hero__search__phone">
                            <div class="hero__search__phone__icon">
                                <i class="fa fa-phone"></i>
                            </div>
                            <div class="hero__search__phone__text">
                                <h5>+65 11.188.888</h5>
                                <span>support 24/7 time</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Hero Section End -->

    <!-- Breadcrumb Section Begin -->
    <section class="container breadcrumb-section set-bg" data-setbg="user/img/image.png">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <div class="breadcrumb__text">
                        <h2>Shop</h2>
                        <div class="breadcrumb__option">
                            <a href="/">Home </a>
                            <span>Shop</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Breadcrumb Section End -->

    <!-- Product Section Begin -->
    <section class="product spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-5">
                    <div class="sidebar">
                        <div class="sidebar__item">
                            <h4>Categories</h4>
                            <ul>
                                <%for(let i=0;i<category.length;i++){%>
                                <li>
                                    <a href="/filter?category=<%=category[i]._id%>"><%=category[i].name%></a>
                                </li>
                                <%}%>
                            </ul>
                        </div>
                        <div class="sidebar__item">
                            <h4>Price</h4>
                            <div class="sidebar__item__size">
                                <a href="/filterPrice?gt=0&lt=2000">
                                <label for="large">
                                    Under 2000
                                </label>
                            </a>
                            </div>
                            <div class="sidebar__item__size">
                                <a href="/filterPrice?gt=2000&lt=4000">
                                    <label for="large">
                                        2000 - 4000
                                    </label>
                                </a>
                            </div>
                            <div class="sidebar__item__size">
                                <a href="/filterPrice?gt=4000&lt=6000">
                                    <label for="large">
                                        4000 - 6000
                                    </label>
                                </a>
                            </div>
                            <div class="sidebar__item__size">
                                <a href="/filterPrice?gt=6000&lt=8000">
                                    <label for="large">
                                        6000 - 8000
                                    </label>
                                </a>
                            </div>
                            <div class="sidebar__item__size">
                                <a href="/filterPrice?gt=8000&lt=10000">
                                    <label for="large">
                                        8000 - 10000
                                    </label>
                                </a>
                            </div>
                            <div class="sidebar__item__size">
                                <a href="/filterPrice?gt=10000&lt=100000">
                                    <label for="large">
                                        Above 10000
                                    </label>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-9 col-md-7">
                    <div class="filter__item">
                        <div class="row">
                            <div class="col-lg-4 col-md-5">
                                <div class="filter__sort">
                                    <span>Sort By</span>
                                    <select id="sortOptions" onchange="sortProducts()">
                                            <option value="default">Default</option>
                                            <option value="price:1">Price : Low - High</option>
                                            <option value="price:-1">Price : High - Low</option>
                                            <option value="name:1">Product Name : A - Z</option>
                                            <option value="name:-1">Product Name : Z - A</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-4">
                                <div class="filter__found">
                                    <h6><span><%=products.length%></span> Products found</h6>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-3 d-flex justify-content-end">
                                <div class="filter__option">
                                    <button class="site-btn" id="clear-btn">CLEAR</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" id="productsContainer">
                        <%for(let i=0;i<products.length;i++){%>
                        
                        <div class="col-lg-4 col-md-6 col-sm-6 product-item" data-createdAt="<%= products[i].createdAt %>" data-price="<%= products[i].salePrice %>" data-name="<%= products[i].productName %>">
                            <div class="product__item">
                                <div class="product__item__pic set-bg" data-setbg="<%=products[i].productImage[0]%>">
                                    <ul class="product__item__pic__hover">
                                        <li><a href="/addToWishlist?productId=<%=products[i]._id%>"><i class="fa fa-heart"></i></a></li>
                                        <li><a href="/addToCart?productId=<%=products[i]._id%>"><i class="fa fa-shopping-cart"></i></a></li>
                                    </ul>
                                </div>
                                <div class="product__item__text">
                                    <h6><a href="/productDetails?id=<%=products[i]._id%>"><%=products[i].productName%></a></h6>
                                    <p class="d-flex justify-content-between"><span style="color: black;"><b>₹<%=products[i].salePrice%></b></span><span class="text-muted"><strike>₹<%=products[i].regularPrice%></strike></span></p>
                                </div>
                            </div>
                        </div>
                        <%}%>

                    </div>

                    <div class="product__pagination" style="padding: 0;">
                        <% if (currentPage > 1) { %>
                          <a class="btn p-0" href="/shop?page=<%= currentPage - 1 %>">Prev</a>
                        <% } %>
                   
                   
                        <% for (let i = 1; i <= totalPages; i++) { %>
                          <a class="btn p-0 <%= currentPage === i ? 'active' : '' %>" href="/shop?page=<%= i %>"><%= i %></a>
                        <% } %>
                   
                   
                        <% if (currentPage < totalPages) { %>
                          <a class="btn p-0" href="/shop?page=<%= currentPage + 1 %>">Next</a>
                        <% } %>
                      </div>
                   
                   
                </div>
            </div>
        </div>
    </section>
    <!-- Product Section End -->

    <%-include("../../views/partials/user/footer")%>

    <script>

    function sortProducts() {
        const selectedValue = document.getElementById("sortOptions").value;
        const container = document.getElementById("productsContainer");
        const products = Array.from(container.getElementsByClassName("product-item"));

        let sortBy, sortOrder;

        if (selectedValue.includes("price")) {
            sortBy = "price";
        } else if (selectedValue.includes("name")) {
            sortBy = "name";
        } else{
            products.sort((a, b) => {
            return new Date(b.getAttribute("data-createdAt")) - new Date(a.getAttribute("data-createdAt"));
            });

            container.innerHTML = "";
            products.forEach(product => container.appendChild(product));
            return;
        }

        sortOrder = selectedValue.includes("-1") ? -1 : 1;


        products.sort((a, b) => {
            let valA = sortBy === "price" ? parseFloat(a.getAttribute("data-price")) : a.getAttribute("data-name").toLowerCase();
            let valB = sortBy === "price" ? parseFloat(b.getAttribute("data-price")) : b.getAttribute("data-name").toLowerCase();

            return sortBy === "price" ? (valA - valB) * sortOrder : valA.localeCompare(valB) * sortOrder;
        });

        container.innerHTML = "";
        products.forEach(product => container.appendChild(product));
    }

    function searchSubmit(event) {
        event.preventDefault();  
        localStorage.setItem("showClearBtn", "true"); 
        document.getElementById('searchForm').submit(); 
    }

    document.getElementById('clear-btn').addEventListener('click', function() {
        document.getElementById('searchInput').value = '';
        localStorage.removeItem("showClearBtn");
        document.getElementById('searchForm').submit();
    });


    window.onload = function() {
        if (localStorage.getItem("showClearBtn") === "true") {
            document.getElementById('clear-btn').style.display = 'block';
        } else {
            document.getElementById('clear-btn').style.display = 'none';
        }
    };

    </script>


</body>

</html>